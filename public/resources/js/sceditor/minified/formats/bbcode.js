/* SCEditor v3.1.1 | (C) 2017, Sam Clarke | sceditor.com/license */

!function(t){"use strict";var c=t.escapeEntities,l=t.escapeUriScheme,f=t.dom,e=t.utils,g=f.css,h=f.attr,m=f.is,n=e.extend,p=e.each,y="data-sceditor-emoticon",u=t.command.get,b={always:1,never:2,auto:3},i={bold:{txtExec:["[b]","[/b]"]},italic:{txtExec:["[i]","[/i]"]},underline:{txtExec:["[u]","[/u]"]},strike:{txtExec:["[s]","[/s]"]},subscript:{txtExec:["[sub]","[/sub]"]},superscript:{txtExec:["[sup]","[/sup]"]},left:{txtExec:["[left]","[/left]"]},center:{txtExec:["[center]","[/center]"]},right:{txtExec:["[right]","[/right]"]},justify:{txtExec:["[justify]","[/justify]"]},font:{txtExec:function(t){var e=this;u("font")._dropDown(e,t,function(t){e.insertText("[font="+t+"]","[/font]")})}},size:{txtExec:function(t){var e=this;u("size")._dropDown(e,t,function(t){e.insertText("[size="+t+"]","[/size]")})}},color:{txtExec:function(t){var e=this;u("color")._dropDown(e,t,function(t){e.insertText("[color="+t+"]","[/color]")})}},bulletlist:{txtExec:function(t,e){this.insertText("[ul]\n[li]"+e.split(/\r?\n/).join("[/li]\n[li]")+"[/li]\n[/ul]")}},orderedlist:{txtExec:function(t,e){this.insertText("[ol]\n[li]"+e.split(/\r?\n/).join("[/li]\n[li]")+"[/li]\n[/ol]")}},table:{txtExec:["[table][tr][td]","[/td][/tr][/table]"]},horizontalrule:{txtExec:["[hr]"]},code:{txtExec:["[code]","[/code]"]},image:{txtExec:function(t,e){var r=this;u("image")._dropDown(r,t,e,function(t,e,n){var i="";e&&(i+=" width="+e),n&&(i+=" height="+n),r.insertText("[img"+i+"]"+t+"[/img]")})}},email:{txtExec:function(t,n){var i=this;u("email")._dropDown(i,t,function(t,e){i.insertText("[email="+t+"]"+(e||n||t)+"[/email]")})}},link:{txtExec:function(t,n){var i=this;u("link")._dropDown(i,t,function(t,e){i.insertText("[url="+t+"]"+(e||n||t)+"[/url]")})}},quote:{txtExec:["[quote]","[/quote]"]},youtube:{txtExec:function(t){var e=this;u("youtube")._dropDown(e,t,function(t){e.insertText("[youtube]"+t+"[/youtube]")})}},rtl:{txtExec:["[rtl]","[/rtl]"]},ltr:{txtExec:["[ltr]","[/ltr]"]}},v={b:{tags:{b:null,strong:null},styles:{"font-weight":["bold","bolder","401","700","800","900"]},format:function(t,e){return`[b guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/b]"},html:function(t,e,n){return`<strong data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</strong>`}},i:{tags:{i:null,em:null},styles:{"font-style":["italic","oblique"]},format:function(t,e){return`[i guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/i]"},html:function(t,e,n){return`<em data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</em>`}},u:{tags:{u:null},styles:{"text-decoration":["underline"]},format:function(t,e){return`[u guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/u]"},html:function(t,e,n){return`<u data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</u>`}},s:{tags:{s:null,strike:null},styles:{"text-decoration":["line-through"]},format:function(t,e){return`[s guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/s]"},html:function(t,e,n){return`<s data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</s>`}},sub:{tags:{sub:null},format:function(t,e){return`[sub guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/sub]"},html:function(t,e,n){return`<sub data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</sub>`}},sup:{tags:{sup:null},format:function(t,e){return`[sup guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/sup]"},html:function(t,e,n){return`<sup data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</sup>`}},font:{tags:{font:{face:null}},styles:{"font-family":null},quoteType:b.never,format:function(t,e){var n;m(t,"font")&&(n=h(t,"face"))||(n=g(t,"font-family"));t=t.getAttribute("data-guid")??"";return"[font="+$(n)+" guid="+d(t)+"]"+e+"[/font]"},html:function(t,e,n){return`<font data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" face="${e.hasOwnProperty("defaultattr")&&e.defaultattr?e.defaultattr:""}" >${n}</font>`}},size:{tags:{font:{size:null}},styles:{"font-size":null},format:function(t,e){var n=h(t,"size"),i=2;return-1<(n=n||g(t,"fontSize")).indexOf("px")?((n=+n.replace("px",""))<12&&(i=1),15<n&&(i=3),17<n&&(i=4),23<n&&(i=5),31<n&&(i=6),47<n&&(i=7)):i=n,"[size="+i+" guid="+d(t.getAttribute("data-guid")??"")+"]"+e+"[/size]"},html:function(t,e,n){return`<font data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" size="${e.hasOwnProperty("defaultattr")&&e.defaultattr?e.defaultattr:""}" >${n}</font>`}},color:{tags:{font:{color:null}},styles:{color:null},quoteType:b.never,format:function(t,e){var n;m(t,"font")&&(n=h(t,"color"))||(n=t.style.color||g(t,"color"));t=t.getAttribute("data-guid")??"";return"[color="+a(n)+" guid="+d(t)+"]"+e+"[/color]"},html:function(t,e,n){var i=e.hasOwnProperty("guid")&&e.guid?d(e.guid):"";return'<font color="'+c(a(e.defaultattr),!0)+'"'+` data-guid="${i}" `+">"+n+"</font>"}},ul:{tags:{ul:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:function(t,e){return`[ul guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/ul]"},html:function(t,e,n){return`<ul data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</ul>`}},list:{breakStart:!0,isInline:!1,skipLastLineBreak:!0,html:function(t,e,n){return`<ul data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</ul>`}},ol:{tags:{ol:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:function(t,e){return`[ol guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/ol]"},html:function(t,e,n){return`<ol data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</ol>`}},li:{tags:{li:null},isInline:!1,closedBy:["/ul","/ol","/list","*","li"],format:function(t,e){return`[li guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/li]"},html:function(t,e,n){return`<li data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</li>`}},"*":{isInline:!1,closedBy:["/ul","/ol","/list","*","li"],html:function(t,e,n){return`<li data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</li>`}},table:{tags:{table:null},isInline:!1,isHtmlInline:!0,skipLastLineBreak:!0,format:function(t,e){return`[table guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/table]"},html:function(t,e,n){return`<table data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</table>`}},tr:{tags:{tr:null},isInline:!1,skipLastLineBreak:!0,format:function(t,e){return`[tr guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/tr]"},html:function(t,e,n){return`<tr data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</tr>`}},th:{tags:{th:null},allowsEmpty:!0,isInline:!1,format:function(t,e){return`[th guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/th]"},html:function(t,e,n){return`<th data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</th>`}},td:{tags:{td:null},allowsEmpty:!0,isInline:!1,format:function(t,e){return`[td guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/td]"},html:function(t,e,n){return`<td data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</td>`}},emoticon:{allowsEmpty:!0,tags:{img:{src:null,"data-sceditor-emoticon":null}},format:function(t,e){return h(t,y)+e},html:"{0}"},hr:{tags:{hr:null},allowsEmpty:!0,isSelfClosing:!0,isInline:!1,format:function(t,e){return`[hr guid=${d(t.getAttribute("data-guid")??"")}]`+e},html:function(t,e,n){return`<hr data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" />`}},img:{allowsEmpty:!0,tags:{img:{src:null}},allowedChildren:["#"],quoteType:b.never,format:function(e,t){function n(t){return e.style?e.style[t]:null}var i,r="";return h(e,y)?t:(i=h(e,"width")||n("width"),t=h(e,"height")||n("height"),"[img"+(r=e.complete&&(i||t)||i&&t?"="+f.width(e)+"x"+f.height(e):r)+" guid="+d(e.getAttribute("data-guid")??"")+"]"+h(e,"src")+"[/img]")},html:function(t,e,n){var i,r="",u=e.width,a=e.height;e.defaultattr&&(u=(i=e.defaultattr.split(/x/i))[0],a=2===i.length?i[1]:i[0]),void 0!==u&&(r+=' width="'+c(u,!0)+'"'),void 0!==a&&(r+=' height="'+c(a,!0)+'"');e=e.hasOwnProperty("guid")&&e.guid?d(e.guid):"";return"<img"+r+' src="'+l(n)+'"'+` data-guid="${e}" `+"/>"}},url:{allowsEmpty:!0,tags:{a:{href:null}},quoteType:b.never,format:function(t,e){var n=h(t,"href"),t=t.getAttribute("data-guid")??"";return"mailto:"===n.substr(0,7)?'[email="'+n.substr(7)+'" guid='+d(t)+"]"+e+"[/email]":"[url="+n+" guid="+d(t)+"]"+e+"[/url]"},html:function(t,e,n){e.defaultattr=c(e.defaultattr,!0)||n;var i=e.hasOwnProperty("guid")&&e.guid?d(e.guid):"";return'<a href="'+l(e.defaultattr)+'"'+` data-guid="${i}" `+">"+n+"</a>"}},email:{quoteType:b.never,html:function(t,e,n){var i=e.hasOwnProperty("guid")&&e.guid?d(e.guid):"";return'<a href="mailto:'+(c(e.defaultattr,!0)||n)+'"'+` data-guid="${i}" `+">"+n+"</a>"}},quote:{tags:{blockquote:null},isInline:!1,quoteType:b.never,format:function(t,e){for(var n,i="data-author",r="",u=t.children,a=0;!n&&a<u.length;a++)m(u[a],"cite")&&(n=u[a]);return(n||h(t,i))&&(r=n&&n.textContent||h(t,i),h(t,i,r),n&&t.removeChild(n),e=this.elementToBbcode(t),r="="+r.replace(/(^\s+|\s+$)/g,""),n&&t.insertBefore(n,t.firstChild)),"[quote"+r+" guid="+d(t.getAttribute("data-guid")??"")+"]"+e+"[/quote]"},html:function(t,e,n){return e.defaultattr&&(n="<cite>"+c(e.defaultattr)+"</cite>"+n),"<blockquote "+` data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" `+">"+n+"</blockquote>"}},code:{tags:{code:null},isInline:!1,allowedChildren:["#","#newline"],format:function(t,e){return`[code guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/code]"},html:function(t,e,n){return`<code data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</code>`}},left:{styles:{"text-align":["left","-webkit-left","-moz-left","-khtml-left"]},isInline:!1,allowsEmpty:!0,format:function(t,e){return`[left guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/left]"},html:function(t,e,n){return`<div align="left" data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</div>`}},center:{styles:{"text-align":["center","-webkit-center","-moz-center","-khtml-center"]},isInline:!1,allowsEmpty:!0,format:function(t,e){return`[center guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/center]"},html:function(t,e,n){return`<div align="center" data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</div>`}},right:{styles:{"text-align":["right","-webkit-right","-moz-right","-khtml-right"]},isInline:!1,allowsEmpty:!0,format:function(t,e){return`[right guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/right]"},html:function(t,e,n){return`<div align="right" data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</div>`}},justify:{styles:{"text-align":["justify","-webkit-justify","-moz-justify","-khtml-justify"]},isInline:!1,allowsEmpty:!0,format:function(t,e){return`[justify guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/justify]"},html:function(t,e,n){return`<div align="justify" data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</div>`}},youtube:{allowsEmpty:!0,tags:{iframe:{"data-youtube-id":null}},format:function(t,e){var n=t.getAttribute("data-guid")??"";return(t=h(t,"data-youtube-id"))?`[youtube guid=${d(n)}]`+t+"[/youtube]":e},html:function(t,e,n){e='<iframe width="560" height="315" frameborder="0" '+`src="https://www.youtube-nocookie.com/embed/${n}?wmode=opaque" `+`data-youtube-id="${n}" allowfullscreen  data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" ></iframe>`;return console.debug("out was ",e),e}},rtl:{styles:{direction:["rtl"]},isInline:!1,format:function(t,e){return`[rtl guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/rtl]"},html:function(t,e,n){return`<div style="direction: rtl" data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</div>`}},ltr:{styles:{direction:["ltr"]},isInline:!1,format:function(t,e){return`[ltr guid=${d(t.getAttribute("data-guid")??"")}]`+e+"[/ltr]"},html:function(t,e,n){return`<div style="direction: ltr" data-guid="${e.hasOwnProperty("guid")&&e.guid?d(e.guid):""}" >${n}</div>`}},ignore:{}};function x(t,i){return t.replace(/\{([^}]+)\}/g,function(t,e){var n=!0;return"!"===e.charAt(0)&&(n=!1,e=e.substring(1)),"0"===e&&(n=!1),void 0===i[e]?t:n?c(i[e],!0):i[e]})}function w(t){return"function"==typeof t}function $(t){return t&&t.replace(/\\(.)/g,"$1").replace(/^(["'])(.*?)\1$/,"$2")}var k="open",E="content",B="newline",O="close";function o(t,e,n,i,r,u){var a=this;a.type=t,a.name=e,a.val=n,a.attrs=i||{},a.children=r||[],a.closing=u||null}function A(t){var h=this;function a(t,e){var n,i,r;return t===k&&(n=e.match(/\[([^\]\s=]+)(?:([^\]]+))?\]/))&&(r=u(n[1]),n[2]&&(n[2]=n[2].trim())&&(i=function(t){var e,n=/([^\s=]+)=(?:(?:(["'])((?:\\\2|[^\2])*?)\2)|((?:.(?!\s\S+=))*.))/g,i={};if("="===t.charAt(0)&&t.indexOf("=",1)<0)i.defaultattr=$(t.substr(1));else for("="===t.charAt(0)&&(t="defaultattr"+t);e=n.exec(t);)i[u(e[1])]=$(e[3])||e[4];return i}(n[2]))),t===O&&(n=e.match(/\[\/([^\[\]]+)\]/))&&(r=u(n[1])),(r=t===B?"#newline":r)&&(t!==k&&t!==O||v[r])||(t=E,r="#"),new o(t,r,e,i)}function f(t,e,n){for(var i=n.length;i--;)if(n[i].type===e&&n[i].name===t)return 1}function g(t,e){t=(t?v[t.name]:{}).allowedChildren;return!h.opts.fixInvalidChildren||!t||-1<t.indexOf(e.name||"#")}function m(t,e,n){var i=/\s|=/.test(t);return w(e)?e(t,n):e===b.never||e===b.auto&&!i?t:'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function p(t){return t.length?t[t.length-1]:null}function u(t){return t.toLowerCase()}h.opts=n({},A.defaults,t),h.tokenize=function(t){var e,n,i,r=[],u=[{type:E,regex:/^([^\[\r\n]+|\[)/},{type:B,regex:/^(\r\n|\r|\n)/},{type:k,regex:/^\[[^\[\]]+\]/},{type:O,regex:/^\[\/[^\[\]]+\]/}];t:for(;t.length;){for(i=u.length;i--;)if(n=u[i].type,(e=t.match(u[i].regex))&&e[0]){r.push(a(n,e[0])),t=t.substr(e[0].length);continue t}t.length&&r.push(a(E,t)),t=""}return r},h.parse=function(t,e){var n=function(t){function e(){return p(c)}function n(t){(e()?e().children:s).push(t)}function i(t){return e()&&(u=v[e().name])&&u.closedBy&&-1<u.closedBy.indexOf(t)}var r,u,a,l,o,d=[],s=[],c=[];for(;r=t.shift();)switch(o=t[0],g(e(),r)||r.type===O&&e()&&r.name===e().name||(r.name="#",r.type=E),r.type){case k:i(r.name)&&c.pop(),n(r),(u=v[r.name])&&!u.isSelfClosing&&(u.closedBy||f(r.name,O,t))?c.push(r):u&&u.isSelfClosing||(r.type=E);break;case O:if(e()&&r.name!==e().name&&i("/"+r.name)&&c.pop(),e()&&r.name===e().name)e().closing=r,c.pop();else if(f(r.name,k,c)){for(;a=c.pop();){if(a.name===r.name){a.closing=r;break}a=a.clone(),d.length&&a.children.push(p(d)),d.push(a)}for(o&&o.type===B&&(u=v[r.name])&&!1===u.isInline&&(n(o),t.shift()),n(p(d)),l=d.length;l--;)c.push(d[l]);d.length=0}else r.type=E,n(r);break;case B:e()&&o&&i((o.type===O?"/":"")+o.name)&&(o.type===O&&o.name===e().name||((u=v[e().name])&&u.breakAfter||u&&!1===u.isInline&&h.opts.breakAfterBlock&&!1!==u.breakAfter)&&c.pop()),n(r);break;default:n(r)}return s}(h.tokenize(t)),t=h.opts;return t.fixInvalidNesting&&function t(e,n,i,r){var u,a,l,o;var d=function(t){t=v[t.name];return!t||!1!==t.isInline};n=n||[];r=r||e;for(a=0;a<e.length;a++)if((u=e[a])&&u.type===k){var s;if(i&&!d(u))if(c=p(n),o=c.splitAt(u),l=1<n.length?n[n.length-2].children:r,g(u,c)&&((s=c.clone()).children=u.children,u.children=[s]),-1<(s=l.indexOf(c))){o.children.splice(0,1),l.splice(s+1,0,u,o);var c=o.children[0];return void(c&&c.type===B&&(d(u)||(o.children.splice(0,1),l.splice(s+2,0,c))))}n.push(u),t(u.children,n,i||d(u),r),n.pop()}}(n),function t(e,n,i){var r,u,a,l,o,d,s,c;var f=e.length;n&&(l=v[n.name]);var g=f;for(;g--;)(r=e[g])&&(r.type===B?(u=0<g?e[g-1]:null,a=g<f-1?e[g+1]:null,c=!1,!i&&l&&!0!==l.isSelfClosing&&(u?d||a||(!1===l.isInline&&h.opts.breakEndBlock&&!1!==l.breakEnd&&(c=!0),l.breakEnd&&(c=!0),d=c):(!1===l.isInline&&h.opts.breakStartBlock&&!1!==l.breakStart&&(c=!0),l.breakStart&&(c=!0))),u&&u.type===k&&(o=v[u.name])&&(i?!1===o.isInline&&(c=!0):(!1===o.isInline&&h.opts.breakAfterBlock&&!1!==o.breakAfter&&(c=!0),o.breakAfter&&(c=!0))),!i&&!s&&a&&a.type===k&&(o=v[a.name])&&(!1===o.isInline&&h.opts.breakBeforeBlock&&!1!==o.breakBefore&&(c=!0),o.breakBefore&&(c=!0),s=c)?e.splice(g,1):(c&&e.splice(g,1),s=!1)):r.type===k&&t(r.children,r,i))}(n,null,e),t.removeEmptyTags&&function t(e){var n,i;var r=function(t){for(var e=t.length;e--;){var n=t[e].type;if(n===k||n===O)return!1;if(n===E&&/\S|\u00A0/.test(t[e].val))return!1}return!0};var u=e.length;for(;u--;)(n=e[u])&&n.type===k&&(i=v[n.name],t(n.children),r(n.children)&&i&&!i.isSelfClosing&&!i.allowsEmpty&&e.splice.apply(e,[u,1].concat(n.children)))}(n),n},h.toHTML=function(t,e){return function t(e,n){var i,r,u,a,l,o,d,s="";o=function(t){return!1!==(!t||(void 0!==t.isHtmlInline?t.isHtmlInline:t.isInline))};for(;0<e.length;)if(i=e.shift()){if(i.type===k)d=i.children[i.children.length-1]||{},r=v[i.name],a=n&&o(r),u=t(i.children,!1),u=r&&r.html?(o(r)||!o(v[d.name])||r.isPreFormatted||r.skipLastLineBreak||(u+="<br />"),w(r.html)?r.html.call(h,i,i.attrs,u):(i.attrs[0]=u,x(r.html,i.attrs))):i.val+u+(i.closing?i.closing.val:"");else{if(i.type===B){if(!n){s+="<br />";continue}l||(s+="<div>"),s+="<br />",e.length||(s+="<br />"),s+="</div>\n",l=!1;continue}a=n,u=c(i.val,!0)}a&&!l?(s+="<div>",l=!0):!a&&l&&(s+="</div>\n",l=!1),s+=u}l&&(s+="</div>\n");return s}(h.parse(t,e),!0)},h.toBBCode=function(t,e){return function t(e){var n,i,r,u,a,l,o,d,s,c="";for(;0<e.length;)if(n=e.shift())if(r=v[n.name],s=!(!r||!1!==r.isInline),u=r&&r.isSelfClosing,l=s&&h.opts.breakBeforeBlock&&!1!==r.breakBefore||r&&r.breakBefore,o=s&&!u&&h.opts.breakStartBlock&&!1!==r.breakStart||r&&r.breakStart,d=s&&h.opts.breakEndBlock&&!1!==r.breakEnd||r&&r.breakEnd,s=s&&h.opts.breakAfterBlock&&!1!==r.breakAfter||r&&r.breakAfter,a=(r?r.quoteType:null)||h.opts.quoteType||b.auto,r||n.type!==k)if(n.type===k){if(l&&(c+="\n"),c+="["+n.name,n.attrs)for(i in n.attrs.defaultattr&&(c+="="+m(n.attrs.defaultattr,a,"defaultattr"),delete n.attrs.defaultattr),n.attrs)n.attrs.hasOwnProperty(i)&&(c+=" "+i+"="+m(n.attrs[i],a,i));c+="]",o&&(c+="\n"),n.children&&(c+=t(n.children)),u||r.excludeClosing||(d&&(c+="\n"),c+="[/"+n.name+"]"),s&&(c+="\n"),n.closing&&u&&(c+=n.closing.val)}else c+=n.val;else c+=n.val,n.children&&(c+=t(n.children)),n.closing&&(c+=n.closing.val);return c}(h.parse(t,e))}}function r(t){return t=parseInt(t,10),isNaN(t)?"00":(t=Math.max(0,Math.min(t,255)).toString(16)).length<2?"0"+t:t}function a(t){var e;return(e=(t=t||"#000").match(/rgb\((\d{1,3}),\s*?(\d{1,3}),\s*?(\d{1,3})\)/i))?"#"+r(e[1])+r(e[2])+r(e[3]):(e=t.match(/#([0-f])([0-f])([0-f])\s*?$/i))?"#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]:t}function d(t){if(!t)return"";return/^[\da-f]{32}$/i.test(t)?t:(console.warn("Bad guid",t),"")}function s(){var o=this;o.stripQuotes=$;var l={},s={ul:["li","ol","ul"],ol:["li","ol","ul"],table:["tr"],tr:["td","th"],code:["br","p","div"]};function c(r,u,e){function a(t){var e=t[0],n=t[1],i=f.getStyle(r,e),t=r.parentNode;return!(!i||t&&f.hasStyle(t,e,i))&&(!n||n.includes(i))}function t(t){l[t]&&l[t][e]&&p(l[t][e],function(t,e){var n=v[t].strictMatch;if(void 0===n&&(n=o.opts.strictMatch),!e||e[n?"every":"some"]((i=n,function(t){var e=t[0],t=t[1];if("style"===e&&"CODE"===r.nodeName)return!1;if("style"===e&&t)return t[i?"every":"some"](a);e=h(r,e);return e&&(!t||t.includes(e))}))){var i,t=v[t].format;return u=w(t)?t.call(o,r,u):function(t){var n=arguments;return t.replace(/\{(\d+)\}/g,function(t,e){return void 0!==n[+e+1]?n[+e+1]:"{"+e+"}"})}(t,u),!1}})}return t("*"),t(r.nodeName.toLowerCase()),u}function d(t){function d(t,l){var o="";return f.traverse(t,function(t){var e="",n=t.nodeType,i=t.nodeName.toLowerCase(),r=s[i],u=t.firstChild,a=!0;"object"==typeof l&&(a=-1<l.indexOf(i),(a=m(t,"img")&&h(t,y)?!0:a)||(r=l)),3!==n&&1!==n||(1===n?m(t,".sceditor-nlf")&&!u||("iframe"!==i&&(e=d(t,r)),a?("code"!==i&&(e=c(t,e,!1)),e=c(t,e,!0),o+=function(t,e){var n=t.nodeName.toLowerCase(),i=f.isInline;if(!i(t,!0)||"br"===n){for(var r,u,a=t.previousSibling;a&&1===a.nodeType&&!m(a,"br")&&i(a,!0)&&!a.firstChild;)a=a.previousSibling;for(;r=((u=t.parentNode)&&u.lastChild)===t,(t=u)&&r&&i(u,!0););r&&"li"!==n||(e+="\n"),"br"!==n&&a&&!m(a,"br")&&i(a,!0)&&(e="\n"+e)}return e}(t,e)):o+=e):o+=t.nodeValue)},!1,!0),o}return d(t)}function t(t,e,n){var i,r,e=new A(o.opts.parserOptions).toHTML(o.opts.bbcodeTrim?e.trim():e);return t||n?(t=e,r=document.createElement("div"),n=function(t,e){if(!f.hasStyling(t)){if(1!==t.childNodes.length||!m(t.firstChild,"br"))for(;i=t.firstChild;)r.insertBefore(i,t);!e||t!==(e=r.lastChild)&&m(e,"div")&&t.nextSibling===e&&r.insertBefore(document.createElement("br"),t),r.removeChild(t)}},g(r,"display","none"),r.innerHTML=t.replace(/<\/div>\n/g,"</div>"),(t=r.firstChild)&&m(t,"div")&&n(t,!0),(t=r.lastChild)&&m(t,"div")&&n(t),r.innerHTML):e}function e(t,e,n,i){var r,u=(n=n||document).createElement("div"),a=n.createElement("div"),l=new A(o.opts.parserOptions);for(a.innerHTML=e,g(u,"visibility","hidden"),u.appendChild(a),n.body.appendChild(u),t&&(u.insertBefore(n.createTextNode("#"),u.firstChild),u.appendChild(n.createTextNode("#"))),i&&g(a,"whiteSpace",g(i,"whiteSpace")),r=a.getElementsByClassName("sceditor-ignore");r.length;)r[0].parentNode.removeChild(r[0]);return f.removeWhiteSpace(u),a=d(a),n.body.removeChild(u),a=l.toBBCode(a,!0),a=o.opts.bbcodeTrim?a.trim():a}o.init=function(){o.opts=this.opts,o.elementToBbcode=d,p(v,function(n,t){var i=!1===t.isInline,e=v[n].tags,t=v[n].styles;t&&(l["*"]=l["*"]||{},l["*"][i]=l["*"][i]||{},l["*"][i][n]=[["style",Object.entries(t)]]),e&&p(e,function(t,e){e&&e.style&&(e.style=Object.entries(e.style)),l[t]=l[t]||{},l[t][i]=l[t][i]||{},l[t][i][n]=e&&Object.entries(e)})}),this.commands=n(!0,{},i,this.commands),this.toBBCode=o.toSource,this.fromBBCode=o.toHtml},o.toHtml=t.bind(null,!1),o.fragmentToHtml=t.bind(null,!0),o.toSource=e.bind(null,!1),o.fragmentToSource=e.bind(null,!0)}o.prototype={clone:function(){var t=this;return new o(t.type,t.name,t.val,n({},t.attrs),[],t.closing?t.closing.clone():null)},splitAt:function(t){var e=this.clone(),n=this.children.indexOf(t);return-1<n&&(t=this.children.length-n,e.children=this.children.splice(n,t)),e}},A.QuoteType=b,A.defaults={breakBeforeBlock:!1,breakStartBlock:!1,breakEndBlock:!1,breakAfterBlock:!0,removeEmptyTags:!0,fixInvalidNesting:!0,fixInvalidChildren:!0,quoteType:b.auto,strictMatch:!1},s.get=function(t){return v[t]||null},s.set=function(t,e){return t&&e&&((e=n(v[t]||{},e)).remove=function(){delete v[t]},v[t]=e),this},s.rename=function(t,e){return t in v&&(v[e]=v[t],delete v[t]),this},s.remove=function(t){return t in v&&delete v[t],this},s.formatBBCodeString=x,t.formats.bbcode=s,t.BBCodeParser=A}(sceditor);